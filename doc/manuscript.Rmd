---
title: "Anthropogenic plant communities of the Iberian Atlantic ecoregion"
output: github_document
bibliography: refs.bib
csl: journal-of-vegetation-science.csl
link-citations: yes
always_allow_html: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r message = FALSE, echo = FALSE, warning = FALSE}
knitr::knit_hooks$set(inline = function(x) {
  prettyNum(x, big.mark = ",")
})
```

# Methods

## Study ecoregion

We studied the anthropogenic plant communities of the Iberian Atlantic ecoregion, i.e. the territories with a temperate climate in the north-western Iberian Peninsula. Our study ecoregion broadly corresponds with the Cantabrian Mixed Forests ecoregion *sensu* (Olson et al. 2001), with the Iberian part of the European Atlantic province *sensu* Rivas-Martínez et al. 2017b, and with the Iberian section of the Atlantic biogeographical region of the European Environmental Agency. To define the study region we followed a fine-scale revision of its geographic borders at high spatial resolution using the most recent biogeographical map of the Iberian Atlantic territories (Fernández Prieto et al. 2020). Our revised Iberian Atlantic ecoregion encompasses 79,891 km^2^ of Portugal, Spain and France. Its climate is temperate with average monthly temperatures ranging from 6 to 20°C, and with total annual precipitation between 1,100 and 2,600 mm, with some areas having warm-dry summers but without the distinctive 2-month drought of the Mediterranean climate (Moreno et al. 1990, Costa et al. 1997, Rivas-Martínez et al. 2017a, 2017b). Nonetheless, the Iberian Atlantic ecoregion is located at the transition between the Mediterranean and the temperate climatic zones in SW Europe.

## Vegetation data

To define our target vegetation units, we followed the definitions of anthropogenic vegetation in the recent classification of the vegetation of Europe by Mucina et al. In our study area, this potentially includes the vegetation classes *Polygono-Poetea annuae*, *Papaveretea rhoeadis*, *Digitario sanguinalis-Eragrostietea minoris*, *Chenopodietea*, *Sisymbrietea*, *Artemisietea vulgaris*, *Epilobietea angustifolii* and *Bidentetea*. To these we added the class *Cymbalario-Parietarietea diffusae* included by Mucina et al. in the vegetation of rock crevices and screes, since this class includes the vegetation of human-made walls in our ecoregion. For the nomenclature of sintaxa we follow Mucina et al. for alliances and higher ranks, and Rivas-Martínez et al. for associations.

As vegetation data for our analyses, we obtained 28,775 vegetation relevés (i.e. records of plant species coexisting in a given sampling plot at a given date) from the Iberian and Macaronesian Vegetation Information System (SIVIM, http://sivim.info/sivi; Font et al. 2010, 2012) representing all vegetation types in our study area (i.e. anthropogenic, semi-natural and natural). Since these plots were sampled by different authors throughout the decades, there was no taxonomical consistency among them, so we homogenised all taxon names and unified the nomenclature for all plots. We followed the methodology of Jiménez-Alfaro et al. (2021b) for the Cantabrian Mountains, which includes c. 80% of the flora in the study area, to create a new checklist of the ecoregion based on the Euro+Med Plantbase (Euro+Med 2022). Other vascular plants that were not included in Euro+Med (e.g. several *Quercus* or *Salix* hybrids, non-native species, etc.), as well as the bryophytes, were classified according to Plants of the World Online (POWO 2022). Fungi and algae were removed. We merged taxa into aggregates (i) when there were sets of very close species with a difficult identification in the field (e.g. *Viola riviniana*, *V. reichenbachiana* and *V. sylvestris* were merged into *Viola riviniana* aggr.), (ii) when the taxon was recently separated in different taxa (e.g. *Hedera helix*, *Hedera hibernica* and *Hedera canariensis* were merged into *Hedera helix* aggr.) and (iii) when it was assumed that not all authors were able to identify or recognize infraspecific taxa (e.g. all *Narcissus pseudonarcissus* subspecies and varieties were merged into *Narcissus pseudonarcissus* aggr.).

We improved the geographical information of the SIVIM relevés using a downscaling procedure. The original position of vegetation relevés in SIVIM was recorded as 10 km x 10 km (52.2%) and 1 km x 1 km (47.8%) grid cells. We assigned more precise geographic coordinates to these plots using the elevation recorded originally by the authors and a Digital Elevation Model (DEM) of the Iberian Peninsula at 200 m grid resolution. In the original 10 km x 10 km or 1 km x 1 km grid cell of each relevé, we (i) kept only those 200 m cells that agreed with the relevé’s elevation (± 50 m); (ii) randomly selected one of these 200 m cells; and (iii) assigned to the relevé the coordinate of the 200 m cell’s centroid, in decimal degrees. By doing this, the plots were downscaled at higher resolution within the 10 km x 10 km cells, assuming that 200 m cells at similar elevations within the same grid cell also have similar climatic conditions.

To identify anthropogenic relevés in the SIVIM database we followed two complementary approaches. Fist, we used the expert system created to classify vegetation plots into EUNIS pan-European habitat classification types (Chytrý et al. 2020). The expert system uses the floristic composition of plots to assign them to habitat types depending on the presence and abundance of diagnostic species. We used the habitats assigned by the expert system to retrieve plots assigned to any habitat related to the vegetation classes we had defined: all habitats in the level 1 code V (vegetated man-made habitats), plus level 3 codes R55 (lowland moist or wet tall-herb and fern fringe) and R57 (herbaceous forest clearing vegetation). Second, we also retrieved relevés if they had been classified by the original authors into any sintaxa belonging to our target anthropogenic vegetation classes (**Supplementary 1**). This produced an initial pool of 3,160 relevés from SIVIM, to which we added 89 relevés of urban or peri-urban plant communities conducted by us or extracted by us from the local literature. After initial exploration of this dataset using Two-Way Indicator Species Analysis (TWINSPAN, Roleček et al. 2009) and DCA ordination, we identified 652 relevés as either not belonging to the target anthropogenic classes or to the geographical area of the ecoregion. We removed these, leaving a dataset of 2,508 relevés for further analysis.

## Definition of target alliances and training dataset

As a previous step to classification, we prepared a revised checklist of potential anthropogenic alliances that could be present in our study ecoregion, based on regional sintaxonomical checklists (Galicia, Asturias, Cantabria) and the recent revision at the European level (Mucina, maps, FloraVeg). The provisional list included 38 alliances. Then, we filtered our dataset to include only those relevés which had been assigned by the authors to any of these 38 alliances (n = 2,201 relevés).

We used sequential TWINSPAN to do a preliminary re-classification of the 2,201 filtered relevés, attempting to re-match the relevés into the *a priori* defined checklist of 38 alliances. We used 3 pseudospecies cut levels (0, 15, 25) with a minimum group size of 10 plots and Sørensen's average dissimilarity, and the R package 'twinspanR' to do the TWINSPAN. To start, we performed TWINSPAN followed by pairwise PERMANOVA fitted with the R package 'vegan' to detect the maximum number of mutually different clusters in the original dataset. The number was 15, so we kept a TWINSPAN classification of the whole dataset into 15 clusters, followed by separate TWINSPANS within each of the 15 clusters. This iterative process allowed us re-assign  relevés to 29 alliances, leaving 789 relevés unclassified.

## Semi-supervised classification

The next step was to apply a semi-supervised classification to assign the so far unclassified relevés to one of the resulting 29 alliances. Semi-supervised classification uses previously defined existing groups of data to assign the unclassified relevés to them (as in supervised classification) but also creates new groups to place the data points that do not match the already existing groups (as in unsupervised classification), allowing to detect new groups and to update the previous classification (De Cáceres et al. 2010, Tichý et al. 2014). We used the 1,719 relevés that we had already re-classified into the 29 alliances types as a training set for the semi-supervised classification. Attempts by the classification to create new groups resulted on new groups with no ecological significance, and thus we kept the results of the classification into the 29 *a priori* alliances. For the classification, we applied a supervised classification with the noise clustering fuzzy algorithm, which allows the relevés to be classified either into the *a priori* groups or into a "noise" group which includes outliers and transitional plots (Wiser & De Caceres 2013). We set the fuzziness coefficient to a low value, m = 1, because we expected there would be many plots of transitional species composition and the distance to noise class was set to d = 1. The analysis was performed using the R package ‘vegclust’ (https://cran.r-project.org/web/packages/vegclust). This analysis resulted in the final classification of 2,085 relevés into 29 alliances and 423 relevés left in the noise group. We used pair-wise PERMANOVA as implemented in the package 'RVAideMemoire' to test the significance of the 29 resulting groups (with 9,999 iterations, euclidean distances and Holm's p-value correction).

## Characteristic species

We calculated sets of characteristic species for each of the 29 alliances. We defined dominant species as species with more than 25% cover in at least 5% of the plots of the alliance; constant species as species with a frequency higher than 50% in the alliance; and diagnostic species as species with an IndVal value with a p-value lower than 0.01 calculated with the package 'labdsv' with 1.000.000 iterations.

## Community traits and ecological requirements

To describe the resulting 29 alliances we compiled a dataset of species traits and ecological preferences for the species pool in the 2,508 classified relevés. For each species, we extracted from Flora iberica its average height, its median month of flowering, the length of the flowering period, and whether it was a neophyte or not. From Floraveg we extracted the species's life forms, and kept 'therophyte' and 'geophyte' for further analysis since these categories had the largest contribution to variances as per an exploratory PCA. We also extracted the ecological indicator values and the disturbance indicator values of each species. In the case of the indicators, we assigned values to species lacking values by calculating weighted average values of the species with values for each plot (weighting by species cover), and then assigning to the missing species the weighted avergae of the plots where it was present (weighting by species cover). We explored the main axes of variation using PCA in FactoMineR, separately for species traits and ecological preferences.
