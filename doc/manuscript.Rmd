---
title: "Anthropogenic plant communities of the Iberian Atlantic ecoregion"
output: github_document
bibliography: refs.bib
csl: journal-of-vegetation-science.csl
link-citations: yes
always_allow_html: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r message = FALSE, echo = FALSE, warning = FALSE}
knitr::knit_hooks$set(inline = function(x) {
  prettyNum(x, big.mark = ",")
})
```

# Methods

We performed all data analyses with R version 4.3.1 [@RN5387], using the R package 'tidyverse' [@RN4662] for data processing and visualization. The original datasets, as well as R code for analysis and creation of the manuscript can be accessed at the GitHub repository https://github.com/efernandezpascual/manmade.

## Study ecoregion

We studied the anthropogenic plant communities of the Iberian Atlantic ecoregion, i.e. the territories with a temperate climate in the north-western Iberian Peninsula. Our study ecoregion broadly corresponds with the Cantabrian Mixed Forests ecoregion *sensu* Olson *et al.* [-@RN4667], with the Iberian part of the European Atlantic province *sensu* Rivas-Martínez *et al.* [-@RN4699] and with the Iberian section of the Atlantic biogeographical region of the European Environmental Agency (https://www.eea.europa.eu/data-and-maps/figures/biogeographical-regions-in-europe-2). To define in detail the study ecoregion we did a fine-scale revision of its geographic borders at high spatial resolution using the most recent biogeographical map of the Iberian Atlantic territories [@RN5372]. The revised Iberian Atlantic ecoregion encompasses 79,891 km^2^ of Portugal, Spain and France. Its climate is temperate with average monthly temperatures ranging from 6 to 20°C, and with total annual precipitation between 1,100 and 2,600 mm, with some areas having warm-dry summers but without the distinctive 2-month drought of the Mediterranean climate [@RN5373]. Nonetheless, the Iberian Atlantic ecoregion is located at the transition between the temperate and the Mediterranean climates in southern Europe.

## Definition of anthropogenic vegetation

To define our target vegetation, we followed the definitions of anthropogenic vegetation in the recent classification of the vegetation of Europe by Mucina *et al.* [-@RN4698]. In our study area, this potentially includes the vegetation classes *Polygono-Poetea annuae*, *Papaveretea rhoeadis*, *Digitario sanguinalis-Eragrostietea minoris*, *Chenopodietea*, *Sisymbrietea*, *Artemisietea vulgaris*, *Epilobietea angustifolii* and *Bidentetea*. For a complete synthesis, we added the class *Cymbalario-Parietarietea diffusae* included by Mucina *et al.* [-@RN4698] in the vegetation of rock crevices and screes, since this class encompasses the vegetation of human-made walls in our ecoregion. For the nomenclature of sintaxa we follow Mucina *et al.* [-@RN4698] for alliances and higher ranks, and Rivas-Martínez *et al.* [-@RN4697] for associations.

## Vegetation data

As vegetation data for our analyses, we obtained all vegetation relevés (i.e. records of plant species coexisting in a given sampling plot at a given date) from our study ecoregion that were available in SIVIM, the Iberian and Macaronesian Vegetation Information System [@RN5374]. These were 28,775 relevés representing all vegetation types (i.e. anthropogenic, semi-natural and natural). Since these relevés were sampled by different authors throughout the decades, there was no taxonomical consistency among them, so we homogenized all taxon names for the whole dataset. We followed the methodology applied by Jiménez-Alfaro *et al.* [-@RN5375] to the Cantabrian Mountains, an area within the study ecoregion which includes c. 80% of the ecoregional flora, to create a new taxonomical checklist for the ecoregion based on the Euro+Med Plantbase [@RN5044]. For vascular plants not included in Euro+Med (e.g. several *Quercus* or *Salix* hybrids, non-native species, etc.), as well as for bryophytes, we followed Plants of the World Online [@RN5376]. We removed Fungi and algae. For analytical purposes, we merged taxa into aggregates (1) when there were sets of very close species with a difficult identification in the field (e.g. *Viola riviniana* + *V. reichenbachiana* + *V. sylvestris* = *Viola riviniana* aggr.), (2) when the taxon was recently separated in different taxa (e.g. *Hedera helix* + *Hedera hibernica* + *Hedera canariensis* = *Hedera helix* aggr.) and (3) when it was assumed that not all authors were able to identify or recognize infraspecific taxa (e.g. all *Narcissus pseudonarcissus* subspecies and varieties = *Narcissus pseudonarcissus* aggr.).

For mapping purposes, we improved the geographical information of the SIVIM relevés using a downscaling procedure. The original position of vegetation relevés in SIVIM was recorded as 10 km x 10 km (52.2%) and 1 km x 1 km (47.8%) grid cells. We assigned more precise geographic coordinates to these plots using the elevation recorded originally by the authors and a digital elevation model (DEM) of the Iberian Peninsula at 200 m grid resolution. From the original 10 km x 10 km or 1 km x 1 km grid cell of each relevé, we (1) kept only those 200 m cells that agreed with the relevé's elevation (± 50 m); (2) randomly selected one of these 200 m cells; and (3) assigned to the relevé the coordinate of the 200 m cell's centroid, in decimal degrees. By doing this, the plots were downscaled at higher resolution within their cells, assuming that 200 m cells at similar elevations within the same grid cell also have similar climatic conditions.

To identify anthropogenic relevés in the SIVIM database we followed two complementary approaches. Fist, we used the expert system created to classify vegetation plots into EUNIS pan-European habitat classification types [@RN5061]. The expert system uses the floristic composition of plots to assign them to habitat types depending on the presence and abundance of characteristic species. We used the habitats assigned by the expert system to retrieve plots that had been assigned to any habitat related to the vegetation classes we had previously defined: all habitats in the level 1 code V (vegetated man-made habitats), plus level 3 codes R55 (lowland moist or wet tall-herb and fern fringe) and R57 (herbaceous forest clearing vegetation). Second, we also retrieved relevés if they had been classified by the original authors of the relevé into any sintaxa belonging to our target anthropogenic vegetation classes (**Supplementary 1**). This produced an initial pool of 3,160 relevés from SIVIM, to which we added 89 relevés of urban or peri-urban plant communities conducted by us or extracted by us from the local literature [@RN5377; @RN5378]. After initial exploration of this dataset using Two-Way Indicator Species Analysis (TWINSPAN) [@RN5379], we identified 652 outlier relevés which either did not belong to the target anthropogenic classes or to the geographical area of the ecoregion. We removed these, leaving a dataset of 2,508 relevés for further analysis: 2,419 relevés from SIVIM, originally recorded in 89 publications see (**Supplementary 2**); plus 89 relevés added by us.

## Definition of target alliances and training dataset

As a previous step before classification, we prepared a revised checklist of potential anthropogenic alliances that could be present in our study ecoregion, based on regional sintaxonomical checklists [@RN5363; @RN5008; @RN5365] and recent revisions at the European level [@RN4698; @RN5371]. The provisional list included 38 alliances. 

Then, we filtered our dataset to include only those relevés which had been assigned by the authors to any of these 38 alliances (n = 2,201 relevés). We used sequential TWINSPANs to do a preliminary re-classification of the 2,201 filtered relevés, attempting to re-match the relevés into the *a priori* defined checklist of 38 alliances. We used 3 pseudospecies cut levels (0, 15, 25) with a minimum group size of 10 plots and Sørensen's average dissimilarity, and the R package 'twinspanR' [@RN5380] to do the TWINSPANs. To start, we did a TWINSPAN classification into 15 clusters, followed by separate TWINSPANS within each cluster. This iterative process allowed us to validate 28 alliances and assign 1,725 relevés to them, leaving 783 relevés as unclassified.

## Semi-supervised classification

Next, we applied a semi-supervised classification to assign the so far unclassified relevés to one of the validated 28 alliances. Semi-supervised classification uses previously defined groups of data to assign the unclassified relevés to them (as in supervised classification) but also creates new groups to place the data points that do not match the already existing groups (as in unsupervised classification), allowing to detect new groups and to update the previous classification [@RN5383]. We used the 1,719 relevés that we had already re-classified into the 28 alliances as a training set for the semi-supervised classification. Attempts by the classification to create new groups resulted on new groups with no ecological significance, and thus we kept the results of the classification into the 28 *a priori* alliances. For the classification, we applied a noise clustering fuzzy algorithm, which allows the relevés to be classified either into the *a priori* groups or into a 'noise' group which includes outliers and transitional relevés [@RN5382]. We set the fuzziness coefficient to a low value (m = 1) to accommodate a high number of transitional relevés; and we set the distance to the noise class to d = 1. We performed this analysis with the R package 'vegclust' [@RN5383]. The semi-supervised classification with noise clustering resulted in the final classification of 2,081 relevés into 28 alliances and 427 relevés left in the noise group. We used pairwise PERMANOVA (with 100,000 iterations, Euclidean distances and Holm's p-value correction) fitted with the R package 'RVAideMemoire' [@RN5381] to detect the maximum number of mutually different clusters in the filtered dataset; and Detrended Correspondence Analysis (DCA) as implemented in the R package 'vegan' [@RN5386] to visualize the relationships between the vegetation groups.

## Characteristic species

We calculated sets of characteristic species [@RN5061] for each of the 28 alliances. We defined dominant species as species with more than 25% cover in at least 5% of the relevés of the alliance; constant species as species with a frequency higher than 50% in the alliance; and diagnostic species as species with an 'IndVal' value with a p-value lower than 0.05, as calculated with the R package 'labdsv' [@RN2311] using 1.000.000 iterations.

## Community traits and ecological requirements

To describe the resulting 28 alliances, we compiled a dataset of species traits and ecological preferences for the species pool of the 2,508 classified relevés. For each species, we extracted from *Flora iberica* [-@RN3243] its maximum height, its median month of flowering, the length of the flowering period, and whether it was a neophyte or not. From FloraVeg.EU [-@RN5385] we extracted the species’ life forms and kept 'therophyte' and 'geophyte' for further analysis since these two categories had the largest contribution to variance as per an exploratory Principal Component Analysis (PCA) performed using the R package 'FactoMineR' [@RN3166]. We also extracted the ecological indicator values [@RN5384] and the disturbance indicator values [@RN5101] of each species. In the case of the ecological and disturbance indicators, we assigned values to species lacking them by (1) calculating weighted average values of the species with values for each plot (weighting by species cover), and (2) assigning to the missing species the weighted average values of the plots where they were present (weighting by species cover). Then, for each relevé we calculated its community-weighted mean (weighting by species cover) for each trait and ecological preference, and explored the main axes of variation using PCA, separately for species traits and ecological preferences.

# Data availability

The original datasets, as well as R code for analysis and creation of the manuscript can be accessed at the GitHub repository https://github.com/efernandezpascual/manmade. Upon publication, a version of record of the repository will be deposited in Zenodo.

# References

::: {#refs}
:::

# Figures

```{r fig1, echo = FALSE, fig.pos = "H", fig.cap = "."}
knitr::include_graphics("../results/figures/dca.png")
```

```{r fig2, echo = FALSE, fig.pos = "H", fig.cap = "."}
knitr::include_graphics("../results/figures/cwms.png")
```

```{r fig3, echo = FALSE, fig.pos = "H", fig.cap = "."}
knitr::include_graphics("../results/figures/boxplots.png")
```

```{r fig4, echo = FALSE, fig.pos = "H", fig.cap = "."}
knitr::include_graphics("../results/figures/maps.png")
```
